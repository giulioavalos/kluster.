<div class="navbar navbar-expand-sm navbar-kluster bg-transparent">
  <div class="container-fluid">
    <%= link_to root_path, class: "navbar-brand" do %>
      <%= image_tag "https://media.istockphoto.com/id/1303141949/photo/white-blank-vinyl-record-disc-label-sticker-template-mock-up-isolated-on-black.jpg?s=612x612&w=0&k=20&c=7JRG_w1joTZPkv_Y-1nx5aVPgLQAPF6sC0gbsJDlsAQ=" %>
    <% end %>

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav me-auto">
        <div class="navbar-item">
        <%= form_tag(search_path, method: :get, class: "navbar-form") do %>
          <div class="field has-addons">
            <div class="control">
              <%= text_field_tag :query, params[:query], placeholder: "Search for artists", class: "input", id: "searchInput" %>
              <%= button_tag "Search", class: "button-purple button", id: "searchButton" %>
            </div>
          </div>
        <% end %>
      </div>
        <% if user_signed_in? %>
          <li class="nav-item dropdown">
            <div class="navbar-brand">
            <%= image_tag "#{current_user.avatar}", class: "avatar dropdown-toggle", id: "navbarDropdown", data: { bs_toggle: "dropdown" }, 'aria-haspopup': true, 'aria-expanded': false %>
            <div class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown">
              <%= link_to "Profile", "#", class: "dropdown-item" %>
              <%= link_to "Log out", destroy_user_session_path, class: "dropdown-item", data: {turbo_method: :delete} %>
            </div>
          </li>
            </div>
        <% else %>
          <!--li class="nav-item"-->
          <button class="button-purple button">
            <%= link_to 'Sign in with Spotify', '/auth/spotify', method: :post %>
          </button>
          <!--/li-->
        <% end %>
      </ul>
    </div>
  </div>
</div>

<script>
 document.addEventListener("DOMContentLoaded", function() {
  const searchInput = document.getElementById("searchInput");
  const searchButton = document.getElementById("searchButton");
  const artistSuggestions = document.getElementById("artistSuggestions");

  searchInput.addEventListener("input", function() {
    const query = searchInput.value.trim();
    if (query.length === 0) {
      artistSuggestions.innerHTML = "";
      return;
    }

    const url = `/search?query=${encodeURIComponent(query)}`;
    fetch(url)
      .then(response => response.json())
      .then(data => {
        artistSuggestions.innerHTML = "";
        data.artists.items.forEach(artist => {
          const artistOption = document.createElement("div");
          artistOption.textContent = artist.name;
          artistOption.classList.add("artist-option");
          artistOption.addEventListener("click", function() {
            searchInput.value = artist.name;
            artistSuggestions.innerHTML = "";
          });
          artistSuggestions.appendChild(artistOption);
        });
      })
      .catch(error => console.error("Error fetching artists:", error));
  });

  searchButton.addEventListener("click", function() {
    const query = searchInput.value.trim();
    if (query.length === 0) {
      artistSuggestions.innerHTML = "";
      return;
    }

    window.location.href = `/search?query=${encodeURIComponent(query)}`;
  });

  // Close suggestions when clicking outside the search input
  document.addEventListener("click", function(event) {
    if (!searchInput.contains(event.target)) {
      artistSuggestions.innerHTML = "";
    }
  });
});

</script>
